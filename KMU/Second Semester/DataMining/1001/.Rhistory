apply(cs.v9[1,],1,fun)
sapply(cs.v9[1,],fun)
apply(cs.v9[1,],1,fun)
apply(cs.v9[1,],2,fun)
apply(cs.v9[1,],1,fun)
cs.v9[1,]
cs.v9$Season <-  apply(cs.v9,1,fun)
fun <- function(x){
SeasonMax <- which.max(x[2:5])
return(colnames(x[SeasonMax]))
}
cs.v9$Season <-  apply(cs.v9,1,fun)
head(cs.v9)
cs.v9$Season <- colnames(which.max(cs.v9[,2:5]))
cs.v9$Summer <- as.integer(cs.v9$Summer)
cs.v9$Winter <- as.integer(cs.v9$Winter)
cs.v9$Season <- colnames(which.max(cs.v9[,2:5]))
head(cs.v9)
cs.v9$Fall <- as.integer(cs.v9$Fall)
head(cs.v9)
cs.v9$Season <- colnames(which.max(cs.v9[,2:5]))
head(cs.v9)
cs.v9$Season <- apply(cs.v9,1,colnames(which.max(cs.v9[,2:5])))
colnames(which.max(cs.v9[,2:5]))
which.max(cs.v9[,2:5])
which(cs.v9[1,] == max(cs.v9[1,]), arr.ind = TRUE)
colnames(cs.v9(1,which(cs.v9[1,] == max(cs.v9[1,]), arr.ind = TRUE)))
colnames(cs.v9(1,which(cs.v9[1,] == max(cs.v9[1,]), arr.ind = TRUE))))
colnames(cs.v9[1,which(cs.v9[1,] == max(cs.v9[1,]), arr.ind = TRUE)])
which(cs.v9[1,] == max(cs.v9[1,]), arr.ind = TRUE)
which.max(cs.v9[1,])
colnames(which.max(cs.v9[1,]))
which.max(cs.v9[1,])
str(which.max(cs.v9[1,]))
names(which.max(cs.v9[1,]))
cs.v9$Season <- apply(cs.v9,1,names(which.max(cs.v9)))
cs.v9$Season <- apply(cs.v9,1,names(which.max()))
fun <- function(x){
SeasonMax <- names(which.max(x))
return(colnames)
}
cs.v9$Season <- apply(cs.v9,1,fun)
head(cs.v9)
cs.v9$Season <- apply(cs.v9,1,FUN = fun)
?apply
fun <- function(x){
SeasonMax <- names(which.max(x))
return(SeasonMax)
}
cs.v9$Season <- apply(cs.v9,1,fun)
cs.v9$Season <- apply(cs.v9,1,fun)
fun <- function(x){
SeasonMax <- names(which.max(x))
return(SeasonMax)
}
fun <- function(x){
SeasonMax <- names(which.max(x))
print(SeasonMax)
#return(SeasonMax)
}
apply(cs.v9,1,fun)
cs.v9$Season <- apply(cs.v9[,2:5],1,fun)
fun <- function(x){
SeasonMax <- names(which.max(x))
#print(SeasonMax)
return(SeasonMax)
}
cs.v9$Season <- apply(cs.v9[,2:5],1,fun)
head(cs.v9)
cs.v9 <- left_join(cs.v9.3,cs.v9.6) %>% left_join(cs.v9.9) %>% left_join(cs.v9.12) %>% summarize(Season = fun)
cs.v9 <- left_join(cs.v9.3,cs.v9.6) %>% left_join(cs.v9.9) %>% left_join(cs.v9.12) %>% summarize(Season = fun())
cs.v9 <- left_join(cs.v9.3,cs.v9.6) %>% left_join(cs.v9.9) %>% left_join(cs.v9.12)
fun <- function(x){
SeasonMax <- names(which.max(x))
return(SeasonMax)
}
cs.v9$Season <- apply(cs.v9[,2:5],1,fun)
head(cs.v9)
cs.v9 <- select(cs.v9,custid,Season)
head(cs.v9)
cs.v10 <- tr %>% filter(net_amt > 0) %>% group_by(goodcd) %>% summarize(amt = sum(net_amt), Cnt = n())
head(cs.v10)
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n())
head(cs.v12)
which.max(cs.v12[cs.v12$custid==1,])
cs.v12[cs.v12$custid==1,]
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n()) %>% arrange(custid,desc(cnt))
head(cs.v12)
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n(), max = max(cnt)) %>% arrange(custid,desc(cnt))
head(cs.v12)
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n()) %>% arrange(custid,desc(cnt))
row.names(which.max(cs.v12[cs.v12$custid==1,]))
which.max(cs.v12[cs.v12$custid==1,])
cs.v12[cs.v12$custid==1,]
cs.v12[cs.v12$custid==1,'cnt']
which.max(cs.v12[cs.v12$custid==1,'cnt'])
which.max(cs.v12[cs.v12$custid==1,'cnt'])
cs.v12[cs.v12$custid==1,'cnt'])
cs.v12[cs.v12$custid==1,'cnt']
?which.max
max(cs.v12[cs.v12$custid==1,'cnt'])
row.names(max(cs.v12[cs.v12$custid==1,'cnt']))
names(max(cs.v12[cs.v12$custid==1,'cnt']))
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n()) %>% slice(which.min(cnt))
head(cs.v12)
cs.v12 <- tr %>% group_by(custid,goodcd) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
head(cs.v12)
MGRP <- function(x){
if(x <= 50000){
result = 1
}else if(x > 50000 & x <= 100000){
result = 2
}else if(x > 100000 & x <= 150000){
result = 3
}else if(x > 150000 & x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
tmp <- tr[tr$net_amt >0,]
tmp <- tmp[!tmp$net_amt>=72000000,]
cs.v8 <- tmp
head(tmp)
cs.v8.2 <- tmp %>% group_by(custid) %>% summarize(avgPay = MGRP(net_amt))
head(cs.v8.2)
head(tmp,1)
head(tmp,10)
head(cs.v8.2)
head(tmp)
cs.v8.2 <- tmp %>% group_by(custid) %>% mutate(avgPay = MGRP(net_amt))
head(cs.v8.2)
head(cs.v8.2[,'avgPay'])
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt))
head(tmp)
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt))
cs.v8.2 <- tmp %>% group_by(custid) %>% mutate(avgPay = MGRP(net_amt))
summarize(cnt=n())
cs.v8.2 <- tmp %>% group_by(custid) %>% mutate(avgPay = MGRP(net_amt)) %>% group_by(custid,avgPay) %>% summarize(cnt=n())
head(cs.v8.2)
head(cs.v8.2,20)
head(tmp)
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt)) %>% group_by(custid,avgPay) %>% summarize(cnt=n())
head(tmp %>% mutate(avgPay = sum(net_amt)))
head(tmp %>% mutate(avgPay = mean(net_amt)))
tmp <- mutate(tmp,avgPay = MGRP(net_amt))
cs.v8.2 <- tmp %>% group_by(custid) %>% mutate(avgPay = MGRP(net_amt))
head(cs.v8.2,20)
head(cs.v8.2[,c('custid','avgPay')],20)
head(cs.v8.2[custid==7579,'avgPay'],20)
head(cs.v8.2[custid==7579,],20)
cs.v8.2 <- tmp %>% group_by(custid) %>% mutate(avgPay = MGRP(net_amt))
head(cs.v8.2[custid==7579,],20)
head(cs.v8.2)
head(cs.v8.2[custid=='7579',],20)
head(cs.v8.2[cs.v8.2$custid=='7579',],20)
head(cs.v8.2[cs.v8.2$custid=='7579','avgPay'],20)
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt))
head(tmp)
MGRP <- function(x){
if(x >0 & x <= 50000){
result = 1
}else if(x > 50000 & x <= 100000){
result = 2
}else if(x > 100000 & x <= 150000){
result = 3
}else if(x > 150000 & x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
cs.v8.2 <- tr %>% mutate(avgPay = MGRP(net_amt))
head(tr$net_amt)
MGRP <- function(x){
if(x >0 && x <= 50000){
result = 1
}else if(x > 50000 && x <= 100000){
result = 2
}else if(x > 100000 && x <= 150000){
result = 3
}else if(x > 150000 && x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
cs.v8.2 <- tr %>% mutate(avgPay = MGRP(net_amt))
head(cs.v8.2)
head(cs.v8.2,20)
head(cs.v8.2[,c('custid','net_amt','avgPay')],20)
MGRP <- function(x){
if(x <= 50000){
result = 1
}else if(x > 50000 & x <= 100000){
result = 2
}else if(x > 100000 & x <= 150000){
result = 3
}else if(x > 150000 & x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
tmp <- tr[tr$net_amt >0,]
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt))
MGRP <- function(x){
print(x)
if(x <= 50000){
result = 1
}else if(x > 50000 & x <= 100000){
result = 2
}else if(x > 100000 & x <= 150000){
result = 3
}else if(x > 150000 & x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
cs.v8.2 <- tmp %>% mutate(avgPay = MGRP(net_amt))
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt))
MGRP <- function(x){
if(x <= 50000){
result = 1
}else if(x > 50000 & x <= 100000){
result = 2
}else if(x > 100000 & x <= 150000){
result = 3
}else if(x > 150000 & x <= 200000){
result = 4
}else{
result = 5
}
return(result)
}
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt))
head(cs.v8.2[,c('custid','net_amt','avgPay')],20)
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>% group_by(custid,avgPay) %>% summarize(Cnt=n())
head(cs.v8.2,20)
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>%
group_by(custid,avgPay) %>%
summarize(Cnt=n()) %>%
slice(which.max(cnt))
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>%
group_by(custid,avgPay) %>%
summarize(Cnt=n()) %>%
slice(which.max(Cnt))
head(cs.v8.2,20)
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>%
group_by(custid,avgPay) %>%
summarize(Cnt=n())
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>% ungroup() %>%
group_by(custid,avgPay) %>%
summarize(Cnt=n())
head(cs.v8.2,20)
cs.v8.2 <- tmp %>% rowwise() %>% mutate(avgPay = MGRP(net_amt)) %>% ungroup() %>%
group_by(custid,avgPay) %>%
summarize(Cnt=n()) %>%
slice(which.max(Cnt))
head(cs.v8.2,20)
Season <- function(x){
if(month >= 3 & month <=5){
result = 'Spring'
}else if(month >= 6 & month <=8){
result = 'Summer'
}else if(month >= 9 & month <=11){
result = 'Fall'
}else{
result = 'Winter'
}
return(result)
}
cs.v9 <- tr
cs.v9$month <- month(ymd_hms(tr$sales_date))
cs.v9 <- tr %>% rowwise() %>% mutate(month=month(ymd_hms(sales_date)),Season = Season(month)) %>%
ungroup() %>% group_by(custid,Season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
cs.v9 <- tr %>% rowwise() %>% mutate(Season = Season(month(ymd_hms(sales_date)))) %>%
ungroup() %>% group_by(custid,Season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
cs.v9 <- tr %>% rowwise() %>% mutate(Season = Season(month(ymd_hms(sales_date)))) %>%
ungroup() %>% group_by(custid,Season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
cs.v9 <- tr %>% rowwise() %>% mutate(Season = Season(month(ymd_hms(sales_date))) %>%
ungroup() %>% group_by(custid,Season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
_
cs.v9 <- tr %>% rowwise() %>% mutate(season = Season(month(ymd_hms(sales_date)))) %>%
ungroup() %>% group_by(custid,season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
cs.v9 <- tr %>% rowwise() %>% mutate(month = month(ymd_hms(sales_date)), season = Season(month)) %>%
ungroup() %>% group_by(custid,season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
tmp <- tr %>% rowwise() %>% mutate(month = month(ymd_hms(sales_date)), season = Season(month))
tmp <- tr %>% rowwise() %>% mutate(month = month(ymd_hms(sales_date)))
cs.v9 <- tr
cs.v9$month <- month(ymd_hms(tr$sales_date))
tmp <- cs.v9 %>% rowwise() %>% mutate(season = Season(month))
head(cs.v9)
str(cs.v9)
tmp <- cs.v9 %>% rowwise() %>% mutate(season = Season(month))
Season <- function(x){
if(month >= 3 & month <=5){
result = 'Spring'
}else if(month >= 6 & month <=8){
result = 'Summer'
}else if(month >= 9 & month <=11){
result = 'Fall'
}else{
result = 'Winter'
}
return(result)
}
head(Season(cs.v9$month))
cs.v9$month <- as.integer(cs.v9$month)
head(Season(cs.v9$month))
Sea <- function(x){
if(month >= 3 & month <=5){
result = 'Spring'
}else if(month >= 6 & month <=8){
result = 'Summer'
}else if(month >= 9 & month <=11){
result = 'Fall'
}else{
result = 'Winter'
}
return(result)
}
head(Sea(cs.v9$month))
Sea <- function(x){
if(x >= 3 & x <=5){
result = 'Spring'
}else if(x >= 6 & x <=8){
result = 'Summer'
}else if(x >= 9 & x <=11){
result = 'Fall'
}else{
result = 'Winter'
}
return(result)
}
head(Sea(cs.v9$month))
tmp <- cs.v9 %>% rowwise() %>% mutate(season = Season(month))
tmp <- cs.v9 %>% rowwise() %>% mutate(season = Sea(month))
head(tmp)
head(tmp$season)
cs.v9 <- tr %>% rowwise() %>% mutate(month = month(ymd_hms(sales_date)), season = Sea(month)) %>%
ungroup() %>% group_by(custid,season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
cs.v9 <- tr %>% rowwise() %>% mutate(month = month(ymd_hms(sales_date)), season = Sea(month))
cs.v9 <- tr
cs.v9$month <- month(ymd_hms(tr$sales_date))
cs.v9 <- tr %>% rowwise() %>% mutate(season = Sea(month))
Sea <- function(x){
if(x >= 3 & x <=5){
result = 'Spring'
}else if(x >= 6 & x <=8){
result = 'Summer'
}else if(x >= 9 & x <=11){
result = 'Fall'
}else{
result = 'Winter'
}
return(result)
}
cs.v9 <- cs.v9 %>% rowwise() %>% mutate(season = Sea(month))
head(cs.v9)
head(cs.v9$season)
cs.v9 <- cs.v9 %>% rowwise() %>% mutate(season = Sea(month)) %>% ungroup()
head(cs.v9)
head(cs.v9$season)
cs.v9 <- cs.v9 %>% group_by(custid,season) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
head(cs.v9)
cs.v11 <- tr
cs.v11$month <- month(ymd_hms(tr$sales_date))
cs.v11 <- cs.v11 %>% group_by(custid,month) %>% summarize(sum_amt=sum(net_amt))
head(cs.v11)
ggplot(cs.v11[cs.v11$custid = 1,], aes(month, sum_amt)) +
geom_line() + stat_smooth(method = 'lm') +
theme(axis.text.x = element_blank())
ggplot(cs.v11[cs.v11$custid = 1,], aes(month, sum_amt)) +
geom_line() + stat_smooth(method = 'lm')
ggplot(cs.v11[cs.v11$custid = 1,], aes(month, sum_amt)) +
geom_line()
summary(cs.v11[cs.v11$custid = 1,])
summary(cs.v11[cs.v11$custid = 1,])
ggplot(cs.v11[cs.v11$custid == 1,], aes(month, sum_amt)) +
geom_line()
cs.v11 <- tr
cs.v11$month <- month(ymd_hms(tr$sales_date))
cs.v11$year <- year(ymd_hms(tr$sales_date))
ymd(ymd_hms(tr$sales_date))
cs.v11$BuyDate <- ym(ymd_hms(tr$sales_date))
cs.v11 <- tr
cs.v11$BuyDate <- ym(ymd_hms(tr$sales_date))
head(ym(ymd_hms(tr$sales_date)))
head(ymd(ymd_hms(tr$sales_date)))
?lubridate
cs <- read.delim("H(TSV)/HDS_Customers.tab",stringsAsFactors = F)
tr <- read.delim("H(TSV)/HDS_Transactions_MG.tab", stringsAsFactors = F)
library(dplyr)
library(lubridate)
library(ggplot2)
install.packages("lubridate")
card <- read.delim("H(TSV)/HDS_Cards.tab",stringsAsFactors = F)
card <- read.table("H(TSV)/HDS_Cards.tab",stringsAsFactors = F)
card <- read.table("H(TSV)/HDS_Cards.tab")
card <- read.table("H(TSV)/HDS_Cards.tab", sep = "\t")
head(card)
card <- read.table("H(TSV)/HDS_Cards.tab", sep = "\t",header = T)
head(card)
tail(card)
head(tr)
head(cs)
str(cs)
summary(cs)
head(tr)
summary(tr)
head(tr$sales_time)
head(hms(tr$sales_time))
head(ymd_hms(tr$sales_time))
library(lubridate)
head(hms(tr$sales_time))
head(tr$sales_time)
str(tr$sales_time)
summary(tr$sales_time)
tmp <- tr
head(nchar(tmp$sales_time))
head(tmp[nchar(tmp$sales_time)==3,]$sales_time)
tmp[nchar(tmp$sales_time)==3,]$sales_time <- paste0("0",tmp$sales_time)
head(tr$sales_time)
head(tmp$sales_time)
tmp <- tr
tmp <- head(tr,100)
tmp
install.packages("IRanges")
install.packages("IRanges")
library(IRanges)
install.packages("Kmisc")
library(Kmisc)
tmp$sales_time <- str_rev(tmp$sales_time)
head(tmp$sales_time)
library(Stringr)
library(stringr)
tmp$sales_time <- paste0(str_sub(tmp$sales_time,1,2),":",str_sub(tmp$sales_time,3,nchar(tmp$sales_time)))
head(tmp$sales_time)
tmp$sales_time <- str_rev(tmp$sales_time)
head(tmp$sales_time)
hms(tmp$sales_time)
hm(tmp$sales_time)
tmp <- tr
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
tmp$time <- str_rev(tmp$time)
head(tmp$time )
tmp$time <- hm(tmp$time)
head(tmp$time)
head(time(tmp$time))
head(times(tmp$time))
str(times(tmp$time))
str(tmp$time)
head(hour(tmp$time))
summary(hour(tmp$time))
which.max(tmp$time)
tmp$time
tail(tmp$time)
tmp$timezone <- hour(tmp$time)
summary(tmp$timezone)
tmp[tmp$timezone==33,]
summary(tmp$sales_time)
tmp <- tr[tr$sales_time!=0,]
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
tmp$time <- str_rev(tmp$time)
tmp$time <- hm(tmp$time)
tmp$timezone <- hour(tmp$time)
summary(tmp$timezone)
tmp[tmp$timezone==33,]
tmp <- tr[tr$sales_time!="00:00:00",]
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
tmp$time <- str_rev(tmp$time)
tmp$time <- hm(tmp$time)
tmp$timezone <- hour(tmp$time)
summary(tmp$timezone)
tmp[tmp$timezone==33,]
tmp[tmp$timezone==33,'sales_date']
summary(tr$sales_time)
head(tr$sales_time)
head(tr)
head(tr[tr$sales_time<900,])
mean(tr$sales_time)
max(tr$sales_time)
round(mean(tr$sales_time))
tmp <- tr
tmp[tmp$sales_time<=900,'sales_time'] <- round(mean(tmp$sales_time))
summary(tmp$sales_time)
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
library(stringr)
library(Kmisc)
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
tmp$time <- str_rev(tmp$time)
tmp$time <- hm(tmp$time)
library(lubridate)
tmp$time <- hm(tmp$time)
tmp$timezone <- hour(tmp$time)
summary(tmp$timezone)
cs.v13 <- tmp %>% group_by(custid,timezone) %>% summarize(cnt=n()) %>% slice(which.max(cnt))
library(dplyr)
cs.v13 <- tmp %>% group_by(custid,timezone) %>% summarize(cnt=n()) %>% slice(which.max(cnt))
head(cs.v13)
