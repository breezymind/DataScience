library(dplyr)
library(lubridate)
library(ggplot2)
cs <- read.delim("H(TSV)/HDS_Customers.tab",stringsAsFactors = F)
tr <- read.delim("H(TSV)/HDS_Transactions_MG.tab", stringsAsFactors = F)
cs.v1 <- tr %>% filter(net_amt < 0) %>% group_by(custid) %>% summarize(rf_amt = sum(net_amt),rf_cnt=n())
cs.v1[order(cs.v1$rf_amt),]
# 고객의 구매상품 다양성에 대한 변수 생
cs.v2 <- tr %>% distinct(custid,brd_nm) %>% group_by(custid) %>% summarize(buy_brd=n())
head(cs.v2)
# 고객의 내점일수와 평균구매 주기를 계산
start_date = ymd(ymd_hms(min(tr$sales_date)))
end_date = ymd(ymd_hms(max(tr$sales_date)))
cs.v3 <- tr %>% distinct(custid,sales_date) %>% group_by(custid) %>% summarize(visits=n()) %>% mutate(API = as.integer(end_date - start_date)/visits)
# 내점 당 구매건수(Number of Purchases Per Visits)
tmp <- tr %>% group_by(custid) %>% summarize(n=n())
cs.v4 <- inner_join(cs.v3, tmp) %>% mutate(NPPV = n/visits) %>% select(custid,NPPV)
head(cs.v4)
#고객의 주중, 주말 구매패턴에 대한 변수 생성
tmp <- tr %>% mutate(wk_amt = ifelse(wday(sales_date) %in% 2:6 ,net_amt,0), we_amt = ifelse(wday(sales_date) %in% c(1,7),net_amt,0)) %>% group_by(custid)
tmp <- tmp %>% summarise_each(funs(sum),wk_amt,we_amt)
cs.v5 <- tmp %>% mutate(wk_pat = ifelse(wk_amt>=we_amt*1.5,"주중형",ifelse(we_amt>=wk_amt*1.5,"주말형","유형없음")))
head(cs.v5)
# 고객의 생일로부터 특정시점의 나이와 연령대의 계산
cs.v6<-cs %>%
mutate(age=year('2001-05-01') -year(ymd_hms(birth))) %>%
mutate(age=ifelse(age < 10 | age > 100, NA, age)) %>%
mutate(age=ifelse(is.na(age),round(mean(age,na.rm=T)),age)) %>%
mutate(agegrp=cut(age, c(0,19,29,39,49,59,69,100), labels=F)*10) %>%
select(custid, age, agegrp)
head(cs.v6)
# cs.v6 <-cs%>% # 위와동일한결과를얻는다른표현
#   mutate(age=year('2001-05-01') -year(ymd_hms(birth)),
#          age=ifelse(age < 10 | age > 100, NA, age),
#          age=ifelse(is.na(age),round(mean(age,na.rm=T)),age),
#          agegrp=cut(age, c(0,19,29,39,49,59,69,100), labels=F)*10) %>%
#   select(custid, age, agegrp)
#H백화점고객의최근12개월구매금액및구매횟수에대한변수생성
end_date <- ymd(ymd_hms(max(tr$sales_date)))
start_date <- ymd('20010501') - months(12)
cs.v7.12 <-tr%>%
filter(start_date<=sales_date& sales_date<=end_date) %>%
group_by(custid) %>%
summarize(amt12=sum(net_amt), nop12=n())
ggplot(cs.v5, aes(wk_pat)) + geom_bar(aes(fill=wk_pat))
cs <- read.delim("H(TSV)/HDS_Customers.tab", stringsAsFactors = F)
tr <- read.delim("H(TSV)/HDS_Transactions_MG.tab", stringsAsFactors = F)
options(echo = F)
options(warn = F)
tr.input <- tr[tr$net_amt >=0,]
tr.input <- tr.input[!tr.input$net_amt>=7200000,]
head(tr.input)
summary.value <- summary(tr.input$net_amt)
head(tr)
max(tr$sales_time)
round(mean(tmp$sales_time))
tmp <- tr
round(mean(tmp$sales_time))
library(Kmisc)
library(stringr)
install.packages("Kmisc")
library(Kmisc)
library(stringr)
library(Kmisc)
library(stringr)
library(dplyr)
library(lubridate)
library(ggplot2)
cs <- read.delim("H(TSV)/HDS_Customers.tab",stringsAsFactors = F)
tr <- read.delim("H(TSV)/HDS_Transactions_MG.tab", stringsAsFactors = F)
options(warn = F)
options(echo = F)
tmp <- tr
tmp[tmp$sales_time<=900,'sales_time'] <- round(mean(tmp$sales_time))
tmp$time <- str_rev(tmp$sales_time)
tmp$time <- paste0(str_sub(tmp$time,1,2),":",str_sub(tmp$time,3,nchar(tmp$time)))
tmp$time <- str_rev(tmp$time)
head(tmp$time)
head(tmp$time)
str(tmp$time)
tmp$time <- hm(tmp$time)
head(tmp$time)
tmp$timezone <- hour(tmp$time)
head(tmp$timezone)
cs.v13 <- tmp %>% group_by(custid,timezone) %>% summarize(cnt=n()) %>% slice(which.max(cnt))
head(cs.v13)
head(cs.v13)
cs.v10 <- tr %>% filter(net_amt > 0) %>% group_by(custid, goodcd) %>% summarize(amt = sum(net_amt), Cnt = n())
head(cs.v10)
tmp <- tr
cs.v14 <- tr %>% group_by(custid,brand) %>% summarize(amt = sum(net_amt), cnt = n())
str(tr)
cs.v14 <- tr %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n())
head(cs.v14)
tmp <- tr[tr$net_amt>0,]
head(cs.v14)
cs.v14 <- tr %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n())
head(cs.v14)
tr[tr$custid==1 & tr$brd_nm=='게스',]
tr[tr$custid==1 & tr$brd_nm=='게스','net_amt']
tmp <- tr[tr$net_amt>0,]
cs.v14 <- tmp %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n())
head(cs.v14)
cs.v14 <- tmp %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n()) %>% slice(which.max(amt))
head(cs.v14)
cs.v14[order(cs.v14$amt, decreasing = T),]
cs.v14 <- tmp %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n()) %>% slice(which.min(amt))
head(cs.v14)
cs.v14 <- tmp %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n()) %>% slice(which.min(amt))
cs.v14[order(cs.v14$amt, decreasing = T),]
tmp <- tr[tr$net_amt>0,]
cs.v14 <- tmp %>% group_by(custid,brd_nm) %>% summarize(amt = sum(net_amt), cnt = n()) %>% slice(which.min(amt))
cs.v14[order(cs.v14$amt, decreasing = T),]
summary(ymd_hms(tr$sales_date))
sys.date <- 20010630
tr.input <- tr
tr.input$sales_date <- as.numeric(gsub("-","",substr(tr.input$sales_date,1,10)))
cs.tmp <- tr.input %>% group_by(custid) %>%
arrange(sales_date) %>%
summarize(avg.date = (mean(diff(sales_date))), last.date = max(sales_date),
sys.date) %>%
mutate(lost.cust = ifelse(sys.date-last.date > avg.date, "Y", "N"))
cs.v13 <- merge(x = tr.input, y = cs.tmp, by = "custid")
head(cs.v13)
head(cs.v13)
head(cs.v13[which(cs.v13$lost.cust == "Y"),])
nrow(cs.v13[which(cs.v13$lost.cust == "Y"),])
nrow(cs.v13[which(cs.v13$lost.cust == "N"),])
table(cs$m_str1)
table(cs$m_time1)
tmp <- tr
tmp <- tr[tr$net_amt>0,]
cs.v15 <- tr %>%filter(net_amt>0) %>% mutate(Ratio=round(dis_amt/tot_amt))
head(cs.v15)
head(cs.v15$Ratio > 0 )
cs.v15 <- tr %>%filter(net_amt>0) %>% mutate(Ratio=round(dis_amt/tot_amt,2))
head(cs.v15$Ratio > 0 )
head(cs.v15[cs.v15$Ratio>0,] )
cs.v15 <- tr %>%filter(net_amt>0) %>% mutate(Ratio=round(dis_amt/tot_amt,2)) %>% group_by(custid) %>% summarize(avgRatio = mean(Ratio))
head(cs.v15[cs.v15$Ratio>0,] )
head(cs.v15)
cs.v15$avgRatio <- round(cs.v15$avgRatio,2)
head(cs.v15)
summary(cs.v15)
nrow(cs.v15)
cs.v15 <- tr %>%filter(net_amt>0) %>% mutate(Ratio=round(dis_amt/tot_amt,2))
nrow(cs.v15)
head(tr$fee_flg_유이자할부)
head(tr$inst_mon)
summary(tr$inst_mon)
cs.v15 <- tr %>%filter(net_amt>0) %>%
mutate(Ratio=dis_amt/tot_amt) %>%
group_by(custid) %>%
summarize(avgRatio = mean(Ratio))
cs.v15$avgRatio <- round(cs.v15$avgRatio,2)
head(cs.v15)
cs.v16 <- tr %>% group_by(custid,inst_mon) %>% summary(cnt = n())
head(vs.v16)
cs.v16 <- tr %>% group_by(custid,inst_mon) %>% summary(cnt = n())
head(vs.v16)
head(cs.v16)
cs.v16 <- tr %>% group_by(custid,inst_mon) %>% summarize(cnt = n())
head(cs.v16)
cs.v16 <- tr %>% group_by(custid,inst_mon) %>% summarize(cnt = n()) %>% slice(which.max(cnt))
head(cs.v16)
cs.v16[cs.v16$inst_mon==12,]
summary(cs.v16$inst_mon)
nrow(cs.v16[cs.v16$inst_mon==12,])
nrow(cs.v16[cs.v16$inst_mon==6,])
nrow(cs.v16[cs.v16$inst_mon==3,])
nrow(cs.v16[cs.v16$inst_mon==1,])
nrow(cs)
28+202+14870+34753
rm(list=ls())
library(dplyr)
library(lubridate)
library(ggplot2)
library(ggmap)
library(maps)
library(stringr)
